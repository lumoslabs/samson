<fieldset>
  <legend>Datadog</legend>
  <div class="col-lg-offset-2">
    <div class="form-group">
      <h3>Deploy events with tags <%= additional_info "In addition to started/finished tags), separated by <code>;</code><br/>Leave empty to not send notifications.".html_safe %></h3>
      <div class="col-lg-6">
        <%= form.text_field :datadog_tags, class: "form-control", placeholder: "Datadog deploy event tags" %>
      </div>
    </div>

    <div class="form-group">
      <h3>Datadog monitors <%= additional_info "Monitors to show on the stage page" %></h3>

      <div class="col-lg-12">
        <% @stage.datadog_monitors # trigger parallel preload %>
        <%= form.fields_for :datadog_monitor_queries, @stage.datadog_monitor_queries + [DatadogMonitorQuery.new] do |fields| %>
          <div>
            <div class="form-group">
              <div class="col-lg-4">
                <%= fields.text_field :query, class: "form-control", placeholder: "ID or comma separated tags" %>
              </div>

              <div class="col-lg-3">
                <% if fields.object.persisted? && example = fields.object.monitors.first %>
                  <% name = truncate(example.name, to: 30) %>
                  <% name += "+#{fields.object.monitors.size - 1}" if fields.object.monitors.size > 1 %>
                  <%= link_to name, fields.object.url %>
                <% end %>
              </div>

              <% if fields.object.persisted? %>
                <div class="col-lg-1 checkbox">
                  <%= fields.label :_destroy do %>
                    <%= fields.check_box :_destroy if fields.object.persisted? %>
                    Delete
                  <% end %>
                </div>
              <% end %>
            </div>

            <div class="form-group checkbox-disable">
              <div class="col-lg-3">
                On Alert <%= fields.select :failure_behavior, options_for_select(DatadogMonitorQuery::FAILURE_BEHAVIORS, fields.object.failure_behavior), include_blank: true %>
                <%= additional_info "Action to take when monitors alerts after a deploy, but did not alert before." %>
              </div>
              <div class="col-lg-9 checkbox-disabled">
                Match
                <%= fields.select :match_source, options_for_select(DatadogMonitorQuery::MATCH_SOURCES, fields.object.match_source), include_blank: true %>
                to
                <%= fields.text_field :match_target, placeholder: "tag" %>
              </div>
            </div>
            <hr/>
          </div>
        <% end %>
        <%= link_to "Add row", "#", class: "duplicate_previous_row" %>
      </div>
    </div>
  </div>
</fieldset>
